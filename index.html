<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>4:44 Clock</title>
<style>
    @import url('https://fonts.googleapis.com/css2?family=Larish+Neue&display=swap');

    body {
        margin: 0;
        height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        font-family: 'Larish Neue', sans-serif;
        font-size: 80px;
        background-color: #ffffff;
        transition: background-color 2s;
    }

    #clock {
        text-align: center;
    }

    #testBtn {
        position: absolute;
        bottom: 20px;
        padding: 10px 20px;
        font-size: 16px;
    }
</style>
</head>
<body>
<div id="clock">00:00</div>
<button id="testBtn">Test 4:44</button>
<audio id="alarm" src="444.mp3"></audio>

<script>
const clock = document.getElementById('clock');
const body = document.body;
const alarm = document.getElementById('alarm');
const testBtn = document.getElementById('testBtn');

// Function to format time to HH:MM
function formatTime(date) {
    let hours = date.getHours();
    let minutes = date.getMinutes();
    if (hours < 10) hours = '0' + hours;
    if (minutes < 10) minutes = '0' + minutes;
    return `${hours}:${minutes}`;
}

// Fade in/out audio
function fadeAudio(audio, fadeIn=true, duration=2000) {
    const stepTime = 50; // ms
    const steps = duration / stepTime;
    let step = 0;
    if (fadeIn) {
        audio.volume = 0;
        audio.play();
        const fadeInInterval = setInterval(() => {
            step++;
            audio.volume = Math.min(step / steps, 1);
            if(step >= steps) clearInterval(fadeInInterval);
        }, stepTime);
    } else {
        const fadeOutInterval = setInterval(() => {
            step++;
            audio.volume = Math.max(1 - step / steps, 0);
            if(step >= steps) {
                audio.pause();
                audio.currentTime = 0;
                clearInterval(fadeOutInterval);
            }
        }, stepTime);
    }
}

let is444Active = false;

function updateClock(trigger=false) {
    const now = new Date();
    const timeString = formatTime(now);
    clock.textContent = timeString;

    const is444 = trigger || (now.getHours() === 4 && now.getMinutes() === 44);

    if (is444 && !is444Active) {
        is444Active = true;
        body.style.backgroundColor = '#ecc09b';
        fadeAudio(alarm, true);
    } else if (!is444 && is444Active) {
        is444Active = false;
        body.style.backgroundColor = '#ffffff';
        fadeAudio(alarm, false);
    }
}

// Update every second
setInterval(updateClock, 1000);

// Test button
testBtn.addEventListener('click', () => {
    updateClock(true);
});
</script>
</body>
</html>
